<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
    integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <style>
        html,
        body {
          height: 100vh;
          text-align: center;
        }
        body {
          display: flex;
          align-items: center;
          justify-content: center;
        }
    
      </style>
</head>
<body>
    <div id="app">
        <div class="container">
          <form class="form-signin" @submit.prevent="signin">
            <h1 class="h3 mb-3 font-weight-normal">
              請先登入
            </h1>
            <div class="form-group">
              <label for="inputEmail" class="sr-only">Email address</label>
              <input id="inputEmail" v-model="user.email" type="email" class="form-control" placeholder="Email address"
                required autofocus>
            </div>
            <div class="form-group">
              <label for="inputPassword" class="sr-only">Password</label>
              <input id="inputPassword" v-model="user.password" type="password" class="form-control"
                placeholder="Password" required>
            </div>
            <button class="btn btn-lg btn-primary btn-block" type="submit">
              登入
            </button>
            <!-- <br>
            <button class="btn btn-outline-primary btn-block" type="button" @click="signout">
              登出
            </button>
            <br>
            <button class="btn btn-outline-primary btn-block" type="button" @click="getData">
              取得資料
            </button> -->
            <p class="mt-5 mb-3 text-muted">
              上傳圖片用
            </p>
          </form>
          <input
            id="customFile"
            type="file"
            class="form-control"
            @change = uploadFile
          >
          此範例未完整，請參考課程介紹修正
          <img :src="filePath" style="max-width: 500px;max-height: 300px;">
          {{ filePath }}
        </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    
      <script>
          const uuid = '1f1839a8-d78f-4fc7-b088-b55e63cc35a3'; // 請使用個人 UUID
          const apiPath = 'https://course-ec-api.hexschool.io/api/';
          new Vue({
            el: '#app',
            data() {
              return {
                user: {
                  email: '',
                  password: '',
                },
                token: '',
                filePath: '',
              };
            },
            methods: {
              signin(){
                const api = `${apiPath}auth/login`;
                axios.post(api, this.user).then((response) => {
                console.log(response)
                const token = response.data.token;
                const expired = response.data.expired;
                document.cookie = `token=${token}; expires=${new Date(expired * 1000)}; path=/`;
               }).catch((error) => {
                console.log(error);
               });
              },

              uploadFile() {
                this.token = document.cookie.replace(/(?:(?:^|.*;\s*)token\s*\=\s*([^;]*).*$)|^.*$/, "$1");
    
                // 選取 DOM 中的檔案資訊
                const uploadedFile = document.querySelector('#customFile').files[0]
                // console.dir(uploadedFile);
    
                // 轉成 Form Data
                const formData = new FormData();
                formData.append('file', uploadedFile);
                
                // 路由、驗證
                const url = `${apiPath}${uuid}/admin/storage`;
                axios.defaults.headers.common.Authorization = `Bearer ${this.token}`;
    
                // 請自行完成 Ajax 範例
                axios.post(url, formData, {
                  headers: {
                    'Content-Type': 'multipart/form-data',
                  }
                })
                .then(response => {
                  console.log(response);
                  this.filePath = response.data.data.path;
                })
              },
            },
          })
        </script>
</body>
</html>